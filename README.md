# good-food

![good_food workflow](https://github.com/healthy-food-and-dietary-products/backend/actions/workflows/good_food_workflow.yaml/badge.svg)

## Локальный запуск приложения в контейнерах

### Клонирование репозитория, создание контейнеров и первоначальная настройка

_Важно: при работе в Linux или через терминал WSL2 все команды docker и docker compose нужно выполнять от имени суперпользователя — начинайте их с sudo._

Склонировать репозиторий на свой компьютер и перейти в него:
```
git clone git@github.com:healthy-food-and-dietary-products/backend.git
cd backend
```

Создать в папках infra и backend/good_food файл .env с переменными окружения, необходимыми 
для работы приложения.

Пример содержимого файла:
```
SECRET_KEY=key
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DB_HOST=db
DB_PORT=5432
EMAIL_HOST_USER=<ваш емейл>
EMAIL_HOST_PASSWORD=<ваш пароль>
MODE=prod
DOCKER=yes
ALLOWED_HOSTS=localhost web
CSRF_TRUSTED_ORIGINS=http://localhost/*
```

Перейти в папку /infra/ и запустить сборку контейнеров с помощью 
docker compose: 
```
cd infra
docker compose up -d
```
После этого будут созданы и запущены в фоновом режиме контейнеры 
(db, web, frontend и nginx).

Внутри контейнера web выполнить миграции и создать админа-суперпользователя для входа 
в Админку:
```
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```
После этого Админка должна быть доступна по адресу: http://localhost/admin/
API Root будет доступен по адресу: http://localhost/api/

### Остановка контейнеров

Для остановки работы приложения можно набрать в терминале команду Ctrl+C 
либо открыть второй терминал и воспользоваться командой
```
docker compose stop 
```
Снова запустить контейнеры без их пересборки можно командой
```
docker compose start 
```

### Динамическая документация api 

Swagger - http://localhost/api/swagger/
Redoc - http://localhost/api/redoc/

## Пользователи

### Создание пользователей

Создание пользователя доступно по эндоинту /api/users/
Для создания пользователя необходимо post-запросом отправить следующие обязательные поля:
- email
- username
- password

Помимо этих полей обязательным при регистации пользователя является поле "Город",
в котором в настоящий момент автоматически указывается "Москва". 

### Аутентификация пользователей

Аутентификация пользователя доступна по эндпойнту /api/token/login/
Для аутентификации необходимо post-запросом отправить следующие обязательные поля:
- email
- password

Чтобы авторизоваться по полученному токену, нужно передать в заголовок
Authorization значение "Token <токен>", например, Token 45645hylijglu54545

### Личный кабинет пользователя

Личный кабинет аутентифицированного пользователя доступен по эндпойнту /api/users/me/ 
Там можно посмотреть информацию о себе (GET-запрос), отредактировать её
(PUT- и PATCH-запросы), в том числе путем добавления новых адресов для доставки,
а также удалить пользователя (DELETE-запрос).

## Корзина покупок

### Создание корзины покупок

Создание корзины покупок доступно по эндпойнту /api/users/{user_id}/shopping_cart/
Оно доступно только авторизованному пользователю.
Для создания корзины необходимо отправить на указанный эндпойнт POST-запрос с полем products(id, quantity)

Пример POST запроса на создание корзины:
```
{
    "products": [
        {"id": "1", "quantity": "9"}, 
        {"id": "3", "quantity": "10"}
    ]
}
```

### Изменение корзины покупок

Изменение корзины покупок доступно по эндойнту /api/users/{user_id}/shopping_cart/{shopping_cart_id}/
Оно доступно только авторизованному пользователю.
Для изменения корзины на указанный эндпойнт необходимо передать PATCH-запросом id корзины (в URL)
и обязательные поля: products(id, quantity).

Пример PATCH запроса на изменение корзины:
```
{
    "products": [
        {"id": "1", "quantity": "9"}, 
        {"id": "3", "quantity": "1"}
    ]
}
```

### Удаление корзины покупок

Удаление корзины покупок доступно по эндпойнту /api/users/{user_id}/shopping_cart/{shopping_cart_id}/
Оно доступно только авторизованному пользователю в отношении собственной корзины.
Для удаления корзины покупок необходимо передать в URL id корзины во время DELETE-запроса
на указанный эндпойнт.
